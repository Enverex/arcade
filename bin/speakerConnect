#!/bin/bash

sudo killall headphoneConnect
echo -e 'disconnect 40:EF:4C:37:9D:FB\nquit' | bluetoothctl

function getConState {
	connected=$(echo -e "info 40:EF:4C:37:9D:FB\n" | bluetoothctl 2>&1 | grep 'Connected: yes')
}

if [ "$1" == 'd' ]; then
	echo -e 'disconnect 40:EF:4C:37:9D:FB\nquit' | bluetoothctl
else
	while true; do
		echo -e 'power on\nconnect 40:EF:4C:37:9D:FB\nquit' | bluetoothctl
		sleep 3
		getConState
		if ! [ -z "${connected}" ]; then
			echo "Connected to Bluetooth speaker."
			exit 0
		fi
	done
fi
